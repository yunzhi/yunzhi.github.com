---
layout: post
title: ARM 基础知识
description: 介绍ARM的基础知识
category: blog
---

## ARM基础知识

1. ARM有两种工作状态：ARM状态，32位指令模式；Thumb状态，执行16位的指令

2. ARM的对齐方式：Arm是以字做对齐方式。
> 大端，数据的低字节存放在存储空间的高低址。//就是我们看存储空间的值是不用反序。
> 小端，数据的低字节存放在存储空间的低地址。

3. ARM有7种工作模式：
> 1.用户模式（usr）：用于执行正常的程序
> 2.快速中断模式（FIQ）：用于高速数据传输
> 3.外部中断模式（IRQ）：通常的中断处理
> 4.管理模式（SVC）：操作系统使用的保护模式
> 5.数据访问终止模式（abt）：当数据或者指令预取终止时进入该模式
> 6.系统模式（sys）：运行具有特权的操作系统任务
> 7.未定义模式（und）：当未定义的指令执行时进入该模式，用于支持硬件

4. 工作模式切换：通过软件修改，或者通过外部中断或异常处理改变。一般的，ARM运行在用户模式，除用户模式之外，其他6种模式称之为非用户模式，或者特权模式。其中除用户模式和系统模式之外的5中称为异常模式

5. ARM微处理器共有37个32位寄存器，其中31个位通用寄存器，6个为状态寄存器。任何模式下，通用寄存器R0-R7（成为未分组寄存器）, 程序计数器PC，一个状态寄存器（CPSR）都是可以访问的。
> + sys 和 User模式下 R0-R14    (15个)
> + FIQ模式下R8_fiq-R14_fiq     （7个）
> + Svc模式下R13_svc-R13_svc （2个）
> + Abt模式下R13_abt,R14_abt （2个）
> +IRQ模式下R13_irq,R14_irq  （2个）
>+ und模式下R13_und,R14_und （2个）
>+ R15（PC寄存器）               （1个）
>+ CPSR（程序状态寄存器）     （1个）
>+ SPSR_fiq，SPSR_svc，SPSR_abt，SPSR_irq，SPSR_und  （5个）

![ARM寄存器图](/images/about_arm/arm_register.png)

6.堆栈指针 R13寄存器 R13 通常作为堆栈指针(SP)。在 ARM 指令集当中,由于没有以特殊方式使用 R13 的指令或其它功能,只是习惯上都这样使用。每个异常模式都有其自身的 R13 分组版本,它通常指向由异常模式所专用的堆栈。在入口处,异常处理程序通常将其它要使用的寄存器值保存到这个堆栈。通过返回时将这些值重装到寄存器中,异常处理程序可确保异常发生时的程序状态不会被破坏。
7.链接寄存器 R14寄存器 R14(也称为链接寄存器或 LR)在结构上有两个特殊功能:

+ 在每种模式下,模式自身的R14版本用于保存子程序返回地址。当使用BL或BLX 指令(注意:ARM7TDMI 没有 BLX 这条指令)调用子程序时,R14 设置为子程序返回地址。子程序返回通过将 R14 复制到程序计数器来实现。通常有下列两种方式: 执行下列指令之一:
		MOV PC,LR		BX LR
或是在子程序入口,使用下列形式的指令将 R14 存入堆栈:
	 STMFD SP!,{<registers>,LR}并使用匹配的指令返回:	LDMFD SP!,{<registers>,PC}+ 当发生异常时,将R14对应的异常模式版本设置为异常返回地址(有些异常有一个小常量的偏移)。异常返回的执行类似于子程序返回,只是使用稍微不同的指令来确保被异常中断的程序状态能够完全恢复。 
6.当前状态寄存器（CPSR）

CPSR在用户级编程时用于存储条件码。例如，这些为可以用来记录比较操作的结果和控制条件转移是否发生。寄存器的低位用于控制寄存器的模式，指令集，这中断使能，而且被保护以防止用户级程序改变它们。条件标志码位于寄存器的高四位，意义如下：
> + N:负数Negative
> + Z:零Zero
> + C:进位Carry
> + V:溢出位oVerflow

7.ARM指令集特点：

+ Load-Store体系结构
+ 3地址的数据处理指令
+ 每条指令都是条件执行
+ 包含非常强大的多寄存器Load和Store指令
+ 能用在单时钟周期内执行的单条指令来完成一项普通的位移操作和一项普通的ALU操作
+ 通过协处理器指令集来扩展ARM指令集，包括在编程模式中增加了新的寄存器和数据类型
+ 在Thumb体系结构中以高密度16位压缩形式表示的指令集






["Yunzhi made"](http://yunzhi.github.io) &copy;
